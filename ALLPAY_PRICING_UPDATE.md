# 💰 עדכון תמחור - Allpay

## מודל תמחור חדש

### תשלום חודשי
- **מחיר:** 5₪/חודש
- **סוג:** תשלום חוזר (Recurring)
- **תקופה:** 30 ימים
- **עמלה:** 0.07₪ (1.45%)

### תשלום שנתי
- **מחיר:** 50₪/שנה
- **סוג:** תשלום חד-פעמי
- **תקופה:** 365 ימים (12 חודשים)
- **עמלה:** 0.73₪ (1.45%)
- **חיסכון:** משלם על 10 חודשים (50₪), מקבל 12 חודשים (2 חודשים במתנה!)

---

## חישוב חיסכון

### תשלום חודשי (12 חודשים):
- 12 × 5₪ = **60₪**
- גישה ל-12 חודשים

### תשלום שנתי:
- **50₪** (משלם על 10 חודשים)
- גישה ל-**12 חודשים** (2 חודשים במתנה!)

### חיסכון:
- משלם: 50₪ (10 חודשים)
- מקבל: 12 חודשים
- **2 חודשים במתנה!** (שווי 10₪)

---

## עדכונים נדרשים

### 1. Backend (`backend/subscription_service.py`)

```python
def get_prices(db: Session) -> Dict[str, float]:
    """Get current prices for Allpay donations"""
    return {
        'monthly': 5.00,  # 5₪/חודש
        'yearly': 50.00   # 50₪/שנה (10 חודשים)
    }
```

### 2. Backend (`backend/allpay_service.py`)

```python
def create_allpay_subscription(...):
    # Calculate expiry date
    if plan_type == 'monthly':
        expires_at = utc_now() + timedelta(days=30)
    else:  # yearly - משלם על 10 חודשים, מקבל 12 חודשים
        expires_at = utc_now() + timedelta(days=365)  # 12 months = 365 days
```

### 3. Frontend (`app/paywall/page.tsx`)

```typescript
const monthlyPrice = 5.00  // 5₪/חודש
const yearlyPrice = 50.00  // 50₪/שנה

// חיסכון = משלם על 10 חודשים, מקבל 12 חודשים
const yearlySavings = 10  // 10₪ חיסכון (2 חודשים במתנה)
const yearlySavingsPercent = Math.round((10 / 60) * 100)  // ~17%

// הצגה:
<div className={styles.savingsBadge}>
  2 חודשים במתנה! (10₪)
</div>
<div className={styles.monthlyEquivalent}>
  {(50 / 12).toFixed(2)}₪ לחודש (12 חודשים)
  <br />
  <small>משלם על 10 חודשים, מקבל 12</small>
</div>
```
```

---

## UI Updates

### טקסטים מומלצים:

**תשלום חודשי:**
- "5₪/חודש"
- "תשלום חוזר חודשי"

**תשלום שנתי:**
- "50₪/שנה"
- "12 חודשים - 2 במתנה!"
- "משלם על 10 חודשים, מקבל 12"
- "{(50 / 12).toFixed(2)}₪ לחודש (12 חודשים)"

---

## Database Settings

### ב-`app_settings` table:
```sql
INSERT INTO app_settings (key, value, description) VALUES
('allpay_monthly_price', '5.00', 'מחיר תשלום חודשי ב-Allpay'),
('allpay_yearly_price', '50.00', 'מחיר תשלום שנתי ב-Allpay (משלם על 10 חודשים, מקבל 12)');
```

---

## Allpay Dashboard

### הגדרת מוצרים:
1. **Monthly Subscription:**
   - שם: "תרומה חודשית - Stay Close"
   - מחיר: 5₪
   - סוג: Recurring (חודשי)

2. **Yearly Payment:**
   - שם: "תרומה שנתית - Stay Close (12 חודשים - 2 במתנה!)"
   - מחיר: 50₪
   - סוג: One-time (חד-פעמי)
   - הערה: משלם על 10 חודשים, מקבל 12 חודשים

---

## הערות חשובות

1. **תשלום שנתי = משלם על 10 חודשים, מקבל 12 חודשים**
   - המשתמש משלם 50₪ (שווה ל-10 חודשים)
   - אבל מקבל 12 חודשים של גישה (2 חודשים במתנה!)
   - אחרי 12 חודשים, צריך לשלם שוב

2. **Recurring רק לחודשי**
   - תשלום חודשי = Recurring (כל חודש אוטומטי)
   - תשלום שנתי = One-time (צריך לשלם שוב אחרי 10 חודשים)

3. **חיסכון למשתמש**
   - אם משלם חודשי 12 חודשים = 60₪ (12 חודשים)
   - אם משלם שנתי = 50₪ (משלם על 10 חודשים, מקבל 12 חודשים)
   - חיסכון = 10₪ (2 חודשים במתנה!)

---

## דוגמה לחישוב

### משתמש שבוחר תשלום חודשי:
- חודש 1: 5₪
- חודש 2: 5₪
- חודש 3: 5₪
- ...
- חודש 12: 5₪
- **סה"כ: 60₪**

### משתמש שבוחר תשלום שנתי:
- תשלום חד-פעמי: 50₪ (משלם על 10 חודשים)
- גישה ל-**12 חודשים** (2 חודשים במתנה!)
- **סה"כ: 50₪** (חיסכון של 10₪ - 2 חודשים במתנה)

---

## מסקנה

התמחור החדש:
- ✅ **פשוט** - 5₪/חודש או 50₪/שנה
- ✅ **מושך** - חיסכון של 2 חודשים בתשלום שנתי
- ✅ **הוגן** - עמלות נמוכות (1.45%)
