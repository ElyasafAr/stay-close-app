# ğŸ”§ Background Job - ×”×¡×‘×¨ ××¤×•×¨×˜

## â“ ××” ×–×” Background Job?

**Background Job = ×ª×”×œ×™×š ×©×¨×¥ ×¢×œ ×”×©×¨×ª (Backend), ×œ× ×¢×œ ×”×œ×§×•×—!**

×–×” **×œ×** ×§×•××¤×•× × ×˜×” ×©×œ ×”×œ×§×•×— - ×–×” ×—×œ×§ ××”-Backend.

---

## ğŸ—ï¸ ××™×¤×” ×›×œ ×“×‘×¨ ×¨×¥?

### Backend (×”×©×¨×ª):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI Server                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  API Endpoints                 â”‚ â”‚
â”‚  â”‚  - /api/contacts               â”‚ â”‚
â”‚  â”‚  - /api/reminders              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Background Job               â”‚ â”‚ â† ×–×” ×¨×¥ ×›××Ÿ!
â”‚  â”‚  - ×‘×•×“×§ ×”×ª×¨××•×ª ×›×œ ×“×§×”        â”‚ â”‚
â”‚  â”‚  - ×©×•×œ×— Push Notifications    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Frontend (×”×“×¤×“×¤×Ÿ):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Browser                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  React App                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Service Worker                â”‚ â”‚ â† ×–×” ×¨×¥ ×›××Ÿ
â”‚  â”‚  - ××§×‘×œ Push Notifications     â”‚ â”‚
â”‚  â”‚  - ××¦×™×’ ×”×ª×¨××•×ª                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ××™ ×¢×•×©×” ××”?

### Background Job (×”×©×¨×ª):
- âœ… ×¨×¥ ×¢×œ ×”×©×¨×ª (Backend)
- âœ… ×‘×•×“×§ ×”×ª×¨××•×ª ×›×œ ×“×§×”
- âœ… ×©×•×œ×— Push Notifications
- âœ… ×œ× ×ª×œ×•×™ ×‘×“×¤×“×¤×Ÿ

### Service Worker (×”×“×¤×“×¤×Ÿ):
- âœ… ×¨×¥ ×‘×“×¤×“×¤×Ÿ (Frontend)
- âœ… ××§×‘×œ Push Notifications
- âœ… ××¦×™×’ ×”×ª×¨××•×ª
- âœ… ×œ× ×‘×•×“×§ ×›×œ×•× - ×¨×§ ××§×‘×œ

---

## ğŸ“¦ ××™×¤×” ×–×” × ××¦× ×‘×§×•×“?

### Background Job (Backend):
```
backend/
â”œâ”€â”€ main.py              # FastAPI app
â”œâ”€â”€ scheduler.py         # â† Background Job ×›××Ÿ!
â””â”€â”€ send_push.py         # ×©×œ×™×—×ª Push Notifications
```

### Service Worker (Frontend):
```
public/
â””â”€â”€ sw.js                # â† Service Worker ×›××Ÿ
```

---

## ğŸš€ ××™×š ××ª×§×™× ×™× Background Job?

### ××¤×©×¨×•×ª 1: Python `schedule` (×¤×©×•×˜)

**×§×•×‘×¥: `backend/scheduler.py`**
```python
import schedule
import time
from datetime import datetime
from database import SessionLocal
from models import Reminder
from send_push import send_push_notification

def check_and_send_reminders():
    """×‘×•×“×§ ×”×ª×¨××•×ª ×•×©×•×œ×— Push Notifications"""
    db = SessionLocal()
    try:
        now = datetime.now()
        
        # ××¦× ×”×ª×¨××•×ª ×©×¦×¨×™×›×•×ª ×œ×”×ª×¤×¢×œ
        reminders = db.query(Reminder).filter(
            Reminder.enabled == True,
            Reminder.next_trigger <= now
        ).all()
        
        for reminder in reminders:
            # ×©×œ×— Push Notification
            send_push_notification(reminder)
            
            # ×¢×“×›×Ÿ next_trigger
            reminder.next_trigger = calculate_next_trigger(...)
        
        db.commit()
    finally:
        db.close()

# ×”×¨×¥ ×›×œ ×“×§×”
schedule.every(1).minutes.do(check_and_send_reminders)

# ×œ×•×œ××” ××™× ×¡×•×¤×™×ª
if __name__ == '__main__':
    while True:
        schedule.run_pending()
        time.sleep(1)
```

**××™×š ×œ×”×¨×™×¥:**
```bash
# ××¤×©×¨×•×ª 1: ×ª×”×œ×™×š × ×¤×¨×“
python backend/scheduler.py

# ××¤×©×¨×•×ª 2: ×—×œ×§ ×-main.py (××•××œ×¥)
# × ×•×¡×™×£ ××ª ×–×” ×œ-main.py
```

---

### ××¤×©×¨×•×ª 2: ×—×œ×§ ×-FastAPI (××•××œ×¥!)

**×§×•×‘×¥: `backend/main.py`**
```python
from fastapi import FastAPI
from contextlib import asynccontextmanager
import asyncio
import threading

# Background Job
def background_job():
    """Background Job - ×‘×•×“×§ ×”×ª×¨××•×ª ×›×œ ×“×§×”"""
    import schedule
    import time
    
    def check_reminders():
        # ×‘×“×•×§ ×•×©×œ×— ×”×ª×¨××•×ª
        pass
    
    schedule.every(1).minutes.do(check_reminders)
    
    while True:
        schedule.run_pending()
        time.sleep(1)

@asynccontextmanager
async def lifespan(app: FastAPI):
    # ×”×ª×—×œ Background Job ×›×©×”×©×¨×ª ××ª×—×™×œ
    thread = threading.Thread(target=background_job, daemon=True)
    thread.start()
    yield
    # × ×™×§×•×™ ×‘×¢×ª ×¡×’×™×¨×”

app = FastAPI(lifespan=lifespan)
```

**×™×ª×¨×•× ×•×ª:**
- âœ… ×¨×¥ ××•×˜×•××˜×™×ª ×›×©×”×©×¨×ª ××ª×—×™×œ
- âœ… ×œ× ×¦×¨×™×š ×ª×”×œ×™×š × ×¤×¨×“
- âœ… ×¤×©×•×˜ ×œ× ×™×”×•×œ

---

### ××¤×©×¨×•×ª 3: Celery (××§×¦×•×¢×™)

**×§×•×‘×¥: `backend/celery_app.py`**
```python
from celery import Celery

app = Celery('reminders')

@app.task
def check_reminders():
    # ×‘×“×•×§ ×•×©×œ×— ×”×ª×¨××•×ª
    pass

# ×”×¨×¥ ×›×œ ×“×§×”
app.conf.beat_schedule = {
    'check-reminders': {
        'task': 'check_reminders',
        'schedule': 60.0,  # ×›×œ 60 ×©× ×™×•×ª
    },
}
```

**××™×š ×œ×”×¨×™×¥:**
```bash
# Worker
celery -A celery_app worker --loglevel=info

# Scheduler
celery -A celery_app beat --loglevel=info
```

**×™×ª×¨×•× ×•×ª:**
- âœ… ××§×¦×•×¢×™
- âœ… ×™×›×•×œ ×œ×¨×•×¥ ×¢×œ ×©×¨×ª × ×¤×¨×“
- âœ… ×™×•×ª×¨ ××•×¨×›×‘

---

## ğŸ¯ ×”××œ×¦×”: FastAPI Lifespan

**×”×›×™ ×¤×©×•×˜ - ×—×œ×§ ×-main.py:**

```python
# backend/main.py
from fastapi import FastAPI
from contextlib import asynccontextmanager
import threading
import schedule
import time

def check_and_send_reminders():
    """Background Job - ×‘×•×“×§ ×”×ª×¨××•×ª ×›×œ ×“×§×”"""
    # ×§×•×“ ×‘×“×™×§×” ×•×©×œ×™×—×”
    pass

def background_job_loop():
    """×œ×•×œ××” ×©×œ Background Job"""
    schedule.every(1).minutes.do(check_and_send_reminders)
    while True:
        schedule.run_pending()
        time.sleep(1)

@asynccontextmanager
async def lifespan(app: FastAPI):
    # ×”×ª×—×œ Background Job
    thread = threading.Thread(target=background_job_loop, daemon=True)
    thread.start()
    print("âœ… Background Job started")
    yield
    # × ×™×§×•×™ ×‘×¢×ª ×¡×’×™×¨×”

app = FastAPI(lifespan=lifespan)
```

**×™×ª×¨×•× ×•×ª:**
- âœ… ×¨×¥ ××•×˜×•××˜×™×ª
- âœ… ×—×œ×§ ××”-FastAPI app
- âœ… ×¤×©×•×˜ ×œ× ×™×”×•×œ
- âœ… ×¢×•×‘×“ ×‘-Railway/Heroku

---

## ğŸ“Š ××™×¤×” ×–×” ×¨×¥?

### Railway/Heroku:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Railway Server                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  FastAPI Process               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ API Endpoints             â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Background Job Thread     â”‚ â”‚ â† ×¨×¥ ×›××Ÿ!
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**×–×” ×¨×¥ ×¢×œ ×”×©×¨×ª - ×œ× ×¢×œ ×”××—×©×‘ ×©×œ×š!**

---

## ğŸ” ××™×š ×–×” ×¢×•×‘×“ ×‘×¤×•×¢×œ?

### 1. ×”×©×¨×ª ××ª×—×™×œ:
```
FastAPI starts â†’ Background Job Thread starts â†’ ×¨×¥ ×›×œ ×“×§×”
```

### 2. ×›×œ ×“×§×”:
```
Background Job â†’ ×‘×“×•×§ ×”×ª×¨××•×ª â†’ ×©×œ×— Push â†’ ×¢×“×›×Ÿ next_trigger
```

### 3. Push Notification:
```
Background Job â†’ FCM â†’ Service Worker â†’ ××¦×™×’ ×”×ª×¨××”
```

---

## âš™ï¸ ××™×š ××ª×§×™× ×™×?

### ×©×œ×‘ 1: ×”×•×¡×£ ××ª ×”×§×•×“ ×œ-main.py
```python
# × ×•×¡×™×£ Background Job
```

### ×©×œ×‘ 2: ×”×•×¡×£ dependencies
```bash
pip install schedule
```

### ×©×œ×‘ 3: ×”×©×¨×ª ×¨×¥ ××•×˜×•××˜×™×ª
```
Railway/Heroku â†’ ××ª×—×™×œ FastAPI â†’ Background Job ××ª×—×™×œ
```

**××™×Ÿ ×¦×•×¨×š ×œ×”×ª×§×™×Ÿ ××©×”×• ×™×“× ×™×ª - ×–×” ×—×œ×§ ××”-Backend!**

---

## ğŸ¯ ×¡×™×›×•×

### Background Job:
- âœ… ×¨×¥ ×¢×œ ×”×©×¨×ª (Backend)
- âœ… ×—×œ×§ ××”-FastAPI app
- âœ… ××ª×—×™×œ ××•×˜×•××˜×™×ª
- âœ… ×œ× ×¦×¨×™×š ×œ×”×ª×§×™×Ÿ ××©×”×• ×™×“× ×™×ª

### Service Worker:
- âœ… ×¨×¥ ×‘×“×¤×“×¤×Ÿ (Frontend)
- âœ… ××ª×§×™×Ÿ ××•×˜×•××˜×™×ª ×›×©×¤×•×ª×—×™× ××ª ×”××¤×œ×™×§×¦×™×”
- âœ… ××§×‘×œ Push Notifications

**×”× ×¢×•×‘×“×™× ×™×—×“:**
- Background Job (×©×¨×ª) â†’ ×‘×•×“×§ ×•×©×•×œ×—
- Service Worker (×“×¤×“×¤×Ÿ) â†’ ××§×‘×œ ×•××¦×™×’

---

## ğŸ“ ××” ×¦×¨×™×š ×œ×¢×©×•×ª?

1. âœ… ×œ×”×•×¡×™×£ Background Job ×œ-`backend/main.py`
2. âœ… ×œ×”×•×¡×™×£ `schedule` ×œ-`requirements.txt`
3. âœ… ×œ×›×ª×•×‘ ××ª ×”×¤×•× ×§×¦×™×” `check_and_send_reminders()`
4. âœ… ×–×” ×”×›×œ! ×¨×¥ ××•×˜×•××˜×™×ª

**×”×× ×ª×¨×¦×” ×©××ª×—×™×œ ×œ×××© ××ª ×–×”?**

